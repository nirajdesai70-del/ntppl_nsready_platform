view: v_scada_history
purpose: Full historical time-series data for SCADA consumption.

owners:
  data_owner: data-eng@groupnish
  steward: scada-team@groupnish

consumers: [scada-team@groupnish]

schema:
  - name: time
    type: timestamptz
    timezone: UTC
    semantics: Event time from device (source_timestamp)
    constraints: [not_null]
  
  - name: device_id
    type: uuid
    semantics: Reference to devices.id
    constraints: [not_null]
  
  - name: parameter_key
    type: text
    semantics: Reference to parameter_templates.key
    constraints: [not_null]
  
  - name: value
    type: double precision
    semantics: Measured value
    constraints: []
  
  - name: quality
    type: integer
    semantics: Quality code (0–255); 192 = good
    constraints: []
  
  - name: source
    type: text
    semantics: Protocol (GPRS/SMS/HTTP/…)
    constraints: []

primary_key: [time, device_id, parameter_key]

privacy:
  pii: false

sla:
  cadence: near-real-time
  delivery_deadline: "within 60s of event"
  late_window_minutes: 5

quality_rules:
  null_pct_max:
    value: 0.05
  duplicate_policy:
    description: "no duplicates per (time, device_id, parameter_key)"

tenant_model:
  rule: "tenant_id = customer_id"
  rationale: "Ensures clean cross-customer isolation and future multi-tenant NSWare compatibility."
  enforcement: "Tenant is derived automatically from project/site/device ownership."

changes:
  process: "PR to /contracts/nsready/v_scada_history.yaml with approvals from data + SCADA owner"
  breaking_change_notice_days: 30

version: 1.0.0
changelog: "/contracts/nsready/v_scada_history_changelog.md"

