# Negative Test Cases Report

**Date**: Sat Nov 22 01:33:03 IST 2025
**Environment**: docker

---

## Test Configuration

- **Ingest URL**: http://localhost:8001/v1/ingest
- **Expected Behavior**: All invalid requests should be rejected with appropriate error codes
- **Note**: 
  - HTTP 422 (Unprocessable Entity) is the correct status for validation errors (FastAPI standard)
  - HTTP 400 (Bad Request) is also acceptable for client errors
  - Parameter key validation happens at database level (async processing) - events may be queued and validated later

---

## Test Cases

ab46b95e2ae4   ntppl_nsready_platform-admin_tool          "uvicorn app:app --h…"   58 minutes ago   Up 58 minutes   0.0.0.0:8000->8000/tcp, [::]:8000->8000/tcp                                                                                 admin_tool
5f5a66c55c29   traefik:v2.10                              "/entrypoint.sh --ap…"   3 days ago       Up 42 hours     0.0.0.0:80->80/tcp, [::]:80->80/tcp, 0.0.0.0:443->443/tcp, [::]:443->443/tcp, 0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp   nsready_traefik
eb60d28f0729   ntppl_nsready_platform-collector_service   "uvicorn app:app --h…"   3 days ago       Up 42 hours     0.0.0.0:8001->8001/tcp, [::]:8001->8001/tcp                                                                                 collector_service
35c59ae87944   ntppl_nsready_platform-db                  "docker-entrypoint.s…"   3 days ago       Up 42 hours     0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp                                                                                 nsready_db
be9cf6008296   nats:2.10-alpine                           "docker-entrypoint.s…"   3 days ago       Up 42 hours     0.0.0.0:4222->4222/tcp, [::]:4222->4222/tcp, 0.0.0.0:8222->8222/tcp, [::]:8222->8222/tcp                                    nsready_nats
Collector health: {"service":"ok","queue_depth":0,"db":"connected","queue":{"consumer":"ingest_workers","pending":0,"ack_pending":0,"redelivered":6,"waiting_pulls":4}}

## 1. Missing Required Fields

**Test: Missing project_id**
- Payload: `{"site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid, keyword check skipped)
- Note: Error message format may vary (FastAPI validation)

**Test: Missing site_id**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid, keyword check skipped)
- Note: Error message format may vary (FastAPI validation)

**Test: Missing device_id**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid, keyword check skipped)
- Note: Error message format may vary (FastAPI validation)

**Test: Missing protocol**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid, keyword check skipped)
- Note: Error message format may vary (FastAPI validation)

**Test: Missing source_timestamp**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid, keyword check skipped)
- Note: Error message format may vary (FastAPI validation)

**Test: Missing metrics array**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z"}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid, keyword check skipped)
- Note: Error message format may vary (FastAPI validation)

**Test: Empty metrics array**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid, keyword check skipped)
- Note: Error message format may vary (FastAPI validation)

## 2. Invalid UUIDs

**Test: Invalid device_id (not UUID)**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"not-a-uuid","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid for validation errors)

**Test: Invalid project_id (not UUID)**
- Payload: `{"project_id":"not-a-uuid","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid for validation errors)

**Test: Invalid site_id (not UUID)**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"not-a-uuid","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid for validation errors)

## 3. Invalid Parameter Keys

**Test: Non-existent parameter_key**
- Payload: Non-existent parameter key
- HTTP Status: 200
- Note: Parameter validation happens at database level (async processing)
- Result: ✅ **PASSED** - Accepted for async validation (database FK will reject)

**Test: Invalid parameter_key format**
- Payload: Invalid parameter key format
- HTTP Status: 200
- Note: Format validation may happen at database level (async processing)
- Result: ✅ **PASSED** - Accepted for async validation (database FK will reject)

**Test: Missing parameter_key in metric**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid for validation errors)

## 4. Invalid Data Types

**Test: Invalid source_timestamp format**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"not-a-date","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid for validation errors)

**Test: Invalid metric value (string)**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":"not-a-number","quality":192}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid for validation errors)

**Test: Invalid quality (string)**
- Payload: `{"project_id":"4360b675-5135-435d-b281-93a551a3986d","site_id":"11cede34-1e6a-47f2-b7b2-8fc4634a760a","device_id":"33333333-3333-3333-3333-333333333333","protocol":"GPRS","source_timestamp":"2025-01-01T00:00:00Z","metrics":[{"parameter_key":"project:4360b675-5135-435d-b281-93a551a3986d:voltage","value":100,"quality":"not-a-number"}]}`
- HTTP Status: 422
- Response: ``
- Result: ✅ **PASSED** - Correctly rejected (status 422 is valid for validation errors)

## 5. Invalid JSON

